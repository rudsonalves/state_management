# 1. Basic Counter Project

Full code here: [master](https://github.com/rudsonalves/state_management/tree/master)

This is a basic counter project refactored with the structure:

- **models**
  - **counter.dart** - a basic counter with a privade attribute **`_value`** and getter/setter, methods to increment/decrement/reset value;
  - **limited_counter.dart** - a counter limited to the range [-5, 5];
  - **person.dart** - a class to store the **`_name`** and **`_surname`** attributes, with getters and setters, and a special getter to generate a full name.
- **pages**
  - **home_page.dart** - show all instances of classes in models folder;
  - **settings_page** - a simple page for reset values in models instances.
- **themes**
  - **colors**
    - **color_schemes.g.dart** - a color scheme generated by [https://m3.material.io/theme-builder#/custom](https://m3.material.io/theme-builder#/custom), with small changes;
  - **theme.dart** - a simple theme file to define lightTheme and darkTheme.
- **app.dart** - a file with MaterialApp declarations
- **main.dart** - a simple main function to run the project.


# 2. ValueNotifier Commit

Full code here: [value_notifier](https://github.com/rudsonalves/state_management/tree/value_notifier)

In this commit, I added a ValueNotifier to implement application state-management and redraw screen widgets on demand.

The transport of instances of the Counter, LimitedCounter, and Person classes continues to be done by the **`Navigator.of(context).pushNamed`** arguments (line 28+ in the **home_page.dart** module).

The implementation was made by main changes:

**Models changes:**
1. in models files, the class attibutes were declared by **`ValueNotifier`** like diff below:

```
- int _value = 0
+ ValueNotifier<int> $value = ValueNotifier(0);
```

2. now the setters and getters take and place values in **`$value.value`**, or **`$name.value`**/**`$surname.value`** for the Person class;

**Modules home_page.dart and settings_page.dart changes:**

3. now the two classes, **`HomePage`** and **`SettingsPage`**, have been transformed into **`StatelessWidget`**. It is not necessary for the classes to be **`StateFullWidget`**s, since the **`ValueListenableBuilder`** and **`AnimatedBuilder`** methods are responsible for redrawing the parts of the screen that are necessary. With that, all **`setState`** calls have been removed from the code;
4. **`onPressed`** can receive methods directly from instances of classes **`HomePage`** and **`SettingsPage`**;
5. `Text()` widgets now are called by a **`ValueListenableBuilder`**, replacing lines like this:

```
Text('${_counter1.value}', style: headlineMedium),
```

by 

```
ValueListenableBuilder(
  valueListenable: _counter1.$value,
  builder: (context, value, _) {
    return Text('$value', style: headlineMedium);
  },
),
```

and 

```
Text('Full Name: ${_person.fullName}'),
```

by a AnimatedBuilder like

```
AnimatedBuilder(
  animation: Listenable.merge([_person.$name, _person.$surname]),
  builder: (context, _) {
    return Text('Full Name: "${_person.fullName}"');
  },
),
```

since the method **`fullName`** needs to listen for changes in **`_person.$name`** and **`_person.$surname`**.


# 3. Provider to Transport Objects

Full code here: [provider](https://github.com/rudsonalves/state_management/tree/provider)

In this commit I will use a wrappper around **InheritedWidget** to make them easier to transport objects around app widget tree. To this is necessary to install a provider package.


```
$ flutter pub add provider
```

For this code, the provier version 6.0.5 is installed.

The code changes are few, and are maked over value_notifier branch. The changes are described below:

**app.dart:**

1. a **`MultiProvider`** is used to warp the **`counter`** in the App class:

```
-   return MaterialApp(...
+   return MultiProvider(
+     providers: [
+       Provider<Counter>(create: (_) => Counter()),
+       Provider<LimitedCounter>(create: (_) => LimitedCounter()),
+       Provider<Person>(create: (_) => Person()),
+     ],
+     child: MaterialApp(...
```

with this, Counter, LimitedCounter, and Person objects are instantiated before the **`MaterialApp`** in the widget tree;

**pages/home_page.dart:**

2. navigation to SettingsPage is changed to. Is not longer pass parameters by arguments. The diff code below shows the changes:

```
-    Navigator.of(context).pushNamed(
-      SettingsPage.routeName,
-      arguments: [_counter1, _counter2, _person],
-    );
+    Navigator.of(context).pushNamed(SettingsPage.routeName);
```

3. the counter1, counter2, and person objects load your values from widget tree by **`Provider.of<T>(Context)`** comands:

```
-   final Counter _counter1 = Counter();
-   final LimitedCounter _counter2 = LimitedCounter();
-   final Person _person = Person();
+   final Counter counter1 = Provider.of<Counter>(context);
+   final LimitedCounter counter2 = Provider.of<LimitedCounter>(context);
+   final Person person = Provider.of<Person>(context);
```

The others changes in this code were cosmetics.

**pages/settings_page.dart**

4. In this module the same strategic is used again. The objects (counter1, counter2, and person) have their values loaded from the widget tree by **`Provider.of<T>(Context)`** comands. With this the lines 14 to 19 are replaced by:

```
+   final Counter counter1 = Provider.of<Counter>(context);
+   final LimitedCounter counter2 = Provider.of<LimitedCounter>(context);
+   final Person person = Provider.of<Person>(context);
```

And again, I made some cosmetics changes in the code.

# 4. MobX

Full code here: [mobx](https://github.com/rudsonalves/state_management/tree/mobx)

**MobX** is a state-management library that makes it simple to connect the reactive data around your application. 

![The heart of MobX are three important concepts:](https://github.com/mobxjs/mobx.dart/raw/master/docs/src/images/mobx-triad.png)

This code was built over provider commit, so install the MobX dependencies:

```
$ flutter pub add mobx flutter_mobx
```

and some more usefull builder packages:

```
$ flutter pub add build_runner --dev
$ flutter pub add mobx_codegen --dev
```

The packages used were:

- **mobx** - a state-management library
- **flutter_mobx** - provides the **`Observer`** widget that listens to observables and automatically rebuilds on changes.
- **mobx_codegen** - adds support for annotating your MobX code with **`@observable`**, **`@computed`**, **`@action`**, making it super simple to use MobX.
- **build_runner** - provides a concrete way of generating files using Dart code.

The changes in the provider commit are a lot, but very simple to implemented. The models folder is where have more chenges.


**models/files.dart:**

To simplify the apresentation I will focus on the **counter.dart** code. The initial code is showed below:

```
import 'package:flutter/material.dart';

class Counter {
  ValueNotifier<int> $value = ValueNotifier(0);

  Counter();

  int get value => $value.value;

  set value(int value) => $value.value = value;

  void increment() => $value.value++;

  void decrement() => $value.value--;

  void reset() => $value.value = 0;
}
```

After adapted to MobX, the code will look like this:

```
import 'package:mobx/mobx.dart';

part 'counter.g.dart';

class Counter = _Counter with _$Counter;

abstract class _Counter with Store {
  @observable
  int _value = 0;

  @computed
  int get value => _value;

  @action
  void setValue(int value) => _value = value;

  @action
  void increment() => _value++;

  @action
  void decrement() => _value--;

  @action
  void reset() => _value = 0;
}
```

Now, the **`Counter`** class is a **`_Counter`** with a **`_$Counter`**  mixin, which will be generated later by **build_runner** + **mobx_codegen**.

All you need to worry about is the code for the **`_Counter`** abstract class. Being an abstract class I removed the constructor. The observable **`_value`** is marked by a decorator **`@observable`**. The getters was marked by decorator **`@computer`** and methods that changes the observable is marked by decorator **`action`**. There is currently no decorator for setter members.

The same must to be  done for the **limited_counter.dart** and **person.dart** files in the **models** folder.

To generated the ***.g.dart** files you need run the command in yout terminal:

```
$ flutter pub run build_runner build
```

or 

```
flutter pub run build_runner watch
```

to run on demand and rebuild the ***.g.dart** files if any changes occur to the base files.

**pages/home_page.dart:**

In the HomePage class, it is only necessary to replace the **`ValueListenableBuilder`** by **`Observer`**, according to the code below:

```
  ValueListenableBuilder(
    valueListenable: counter1.$value,
    builder: (context, value, _) {
      return Text('$value', style: headlineMedium);
    },
  ),
```
replace by:

```
  Observer(
    builder: (context) {
      return Text('${counter1.value}', style: headlineMedium);
    },
  ),
```
